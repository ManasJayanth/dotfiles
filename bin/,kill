#!/bin/bash
#
# Use fzf as an interface to kill

set -e

pids=$(ps -ef | sed 1d | fzf-tmux --exact -m --header ",kill" | awk '{print $2}')

for pid in ${pids}; do

    python -c "int('$pid')" 2>/dev/null || exit  # Exit if we didn't get a PID

    ps -ef | grep "$pid"
    echo

    # -15 is the default signal
    read -p "Enter kill signal for $pid if requored (defaults to 15 SIGTERM): " -r
    if [ -z $REPLY ]; then
        cmd="kill $pid"
    else
        cmd="kill -$REPLY $pid"
    fi

    read -p "Are you sure you want to run command: $cmd (y/n) " -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "Exiting."
        exit
    fi

    echo "Sending signal..."
    $cmd
    echo "...done"
done
